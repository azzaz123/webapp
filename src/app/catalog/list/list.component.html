<div class="page-content"
     infiniteScroll
     [infiniteScrollDistance]="5"
     [infiniteScrollThrottle]="100"
     [scrollWindow]="false"
     [infiniteScrollDisabled]="end || loading"
     (scrolled)="loadMore()"
     [scrollTop]="scrollTop">
  <tsl-spinner [firstLoad]="false" *ngIf="isUrgent && isRedirect"></tsl-spinner>
  <div class="container" *ngIf="!isUrgent || !isRedirect">

  <tsl-header>
    <div class="col-6 col-md-7">
      <div class="header-row">
        <h1 class="header-title">
          <span class="d-none d-md-block" i18n>Your products</span>
          <div class="d-md-none flex-column">
            <div class="mb-2" i18n>{{user.microName}}</div>
            <tsl-stars [stars]="userScore" [normalized]="false"></tsl-stars>
          </div>
          <span class="badge badge-pro" *ngIf="userService?.user?.featured || subscriptionSlots.length !== 0">
            <mat-icon svgIcon="pro-seal"></mat-icon>
            Pro
          </span>
        </h1>
      </div>
      <div class="header-row d-none d-md-block">
        <h4 class="header-subtitle" i18n>Here you can list items, manage the ones you already have and featured to
          sell them faster</h4>
      </div>
    </div>
    <div class="col info d-none d-md-block">
      <mat-icon svgIcon="feature"></mat-icon>
      <a (click)="bumpTutorial.show()" i18n>What can features do for you?</a>
    </div>
    <div class="col-6 col-md-2 header-numbers">
      <p class="header-numbers-top d-none d-md-block">
        <span *ngIf="numberOfProducts === 0 && loading">--</span>
        <span *ngIf="!loading">{{numberOfProducts}}</span>
      </p>
      <p class="header-numbers-bottom d-none d-md-block">
        <span *ngIf="numberOfProducts > 1 || numberOfProducts === 0" i18n>products</span>
        <span *ngIf="numberOfProducts === 1" i18n>product</span>
      </p>
      <div class="d-flex justify-content-end d-md-none">
        <tsl-user-avatar [user]="user" size="60"></tsl-user-avatar>
        <!-- <a [routerLink]="['/profile/info']" i18n>Editar perfil</a> -->
      </div>
    </div>
  </tsl-header>

    <tsl-subscriptions-slots-list
      [subscriptionsSlots]="subscriptionSlots"
      [selectedSubscriptionSlot]="selectedSubscriptionSlot"
      (subscriptionSlotSelected)="onSelectSubscriptionSlot($event)"
    >
    </tsl-subscriptions-slots-list>

    <tsl-nav-links
      [searchPlaceholder]="searchPlaceholder"
      [showSearchInput]="selectedSubscriptionSlot"
      [selectedLinkId]="selectedStatus"
      [navLinks]="navLinks"
      [showSortItems]="selectedSubscriptionSlot"
      [sortItems]="sortItems"
      (clickedLink)="filterByStatus($event)"
      (sortChanged)="onSortChange($event)"
      (searchChanged)="onSearchInputChange($event)"
    >
    </tsl-nav-links>

    <div class="row items">
      <div id="catalog-empty-state" *ngIf="!items.length && !loading">
        <mat-icon svgIcon="items-empty-state" class="image"></mat-icon>
      </div>

      <tsl-catalog-item 
        *ngFor="let item of items"
        class="col-md-12" 
        [item]="item"
        [paymentMethod]="isStripe ? 'STRIPE' : 'SABADELL'"
        (itemChange)="itemChanged($event)"
        (purchaseListingFee)="purchaseListingFee($event)"
      >
      </tsl-catalog-item>

      <tsl-spinner [hidden]="!loading"></tsl-spinner>
    </div>
  </div>
</div>

<tsl-selected-items *ngIf="items.length"
  [items]="items"
  [selectedSubscriptionSlot]="selectedSubscriptionSlot"
  [selectedStatus]="selectedStatus"
  [isStripe]="isStripe"
  (selectedAction)="onAction($event)"
>
</tsl-selected-items>

<tsl-sabadell [hidden]="isStripe" [submit]="sabadellSubmit"></tsl-sabadell>
<tsl-bump-tutorial></tsl-bump-tutorial>
<button [hidden]="true" tslItemSold></button>
