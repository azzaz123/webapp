<form [formGroup]="uploadForm" (ngSubmit)="onSubmit()">
  <div class="box">
    <h2 i18n>Information about your item</h2>
    <div class="row">
      <div class="col-sm-12">
        <div class="form-group">
          <label for="headline" i18n>What are you selling?</label>
          <span class="chars-counter"
            >{{ uploadForm.value?.title?.length }}/50</span
          >
          <input
            i18n-placeholder
            placeholder="In some words..."
            type="text"
            class="form-control"
            formControlName="title"
            [ngbPopover]="coachmarkTitle"
            #title
            id="headline"
            maxlength="50"
          />
          <ng-template #coachmarkTitle>
            <div i18n>
              Don't make errors so that people will find you easily.
            </div>
          </ng-template>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-4">
        <div class="form-group">
          <label for="price" i18n>Price</label>
          <input
            i18n-placeholder
            placeholder="(don't go crazy)"
            type="number"
            class="form-control"
            formControlName="sale_price"
            [ngbPopover]="coachmarkPrice"
            id="price"
            min="0"
            max="999999999"
          />
          <ng-template #coachmarkPrice>
            <div i18n>
              Add a fair price and the category that best suits your item.
            </div>
          </ng-template>
        </div>
      </div>
      <div class="col-sm-2">
        <div class="form-group">
          <label for="currency" i18n>Currency</label>
          <ng-select
            class="form-control"
            formControlName="currency_code"
            id="currency"
            [ngbPopover]="coachmarkPrice"
            #p1="ngbPopover"
            triggers="manual"
            (opened)="p1.open()"
            (closed)="p1.close()"
            [options]="currencies"
            noFilter="10"
          ></ng-select>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="form-group">
          <label for="category" i18n>Category</label>
          <ng-select
            [hidden]="fixedCategory"
            i18n-placeholder
            placeholder="Category"
            (selected)="onCategoryChange($event)"
            class="form-control"
            formControlName="category_id"
            [ngbPopover]="coachmarkPrice"
            #p2="ngbPopover"
            triggers="manual"
            (opened)="p2.open()"
            (closed)="p2.close()"
            id="category"
            [options]="categories"
            noFilter="10"
          >
            <ng-template #optionTemplate let-option="option">
              <div (click)="setCategory(option.value)">
                <mat-icon svgIcon="cat_{{ option?.icon_id }}"></mat-icon>
                {{ option?.label }}
              </div>
            </ng-template>
          </ng-select>
          <input
            *ngIf="fixedCategory"
            disabled
            type="text"
            class="form-control"
            [value]="fixedCategory"
          />
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12">
        <div class="form-group last">
          <label for="tellUs" i18n>Description</label>
          <span class="chars-counter"
            >{{ uploadForm.value?.description?.length }}/650</span
          >
          <textarea
            i18n-placeholder
            placeholder="Add relevant information such as condition, model, color..."
            fz-elastic
            class="form-control"
            [ngbPopover]="coachmarkDescription"
            formControlName="description"
            id="tellUs"
            maxlength="650"
          ></textarea>
          <ng-template #coachmarkDescription>
            <div i18n>Every detail helps: so tell us more!</div>
          </ng-template>
        </div>
      </div>
    </div>
  </div>
  <div
    class="box product-photos"
    [ngbPopover]="coachmarkPictures"
    triggers="mouseenter:mouseleave"
  >
    <h2
      [ngClass]="{
        'ng-invalid':
          !uploadForm.controls.images.valid && uploadForm.controls.images.dirty
      }"
      i18n
    >
      Photos
    </h2>
    <tsl-drop-area
      [uploadEvent]="uploadEvent"
      type="consumer_goods"
      (onUploaded)="onUploaded($event)"
      (onError)="onError($event)"
      formControlName="images"
      [images]="item?.images"
      [itemId]="item?.id"
    ></tsl-drop-area>
    <ng-template #coachmarkPictures>
      <div i18n>
        You can drag and drop your photos here. Select and drag to change the
        order. Max 10MB. We accept only .jpg images.
      </div>
    </ng-template>
  </div>
  <div class="box" *ngIf="extraInfoEnabled">
    <h2><span i18n>The more precise, the better</span></h2>
    <div class="row" formGroupName="extra_info">
      <div class="col-sm-4">
        <div class="form-group last" formGroupName="object_type">
          <label for="objectType">{{ objectTypeTitle }}</label>
          <ng-select
            class="form-control"
            formControlName="id"
            id="objectType"
            i18n-placeholder
            placeholder="Select a type"
            [options]="objectTypes"
            noFilter="10"
          ></ng-select>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="form-group last">
          <label for="brand" i18n>Brand</label>
          <tsl-keyword-suggester
            placeholder="brand_example"
            [initialValue]="item?.extraInfo?.brand"
            [value]="selectedBrand"
            [suggestions]="brandSuggestions"
            (inputChange)="getBrands($event)"
            (suggestionSelect)="selectBrandOrModel($event, 'brand')"
          >
          </tsl-keyword-suggester>
        </div>
      </div>
      <div class="col-sm-4">
        <div class="form-group last">
          <label for="model" i18n>Model</label>
          <tsl-keyword-suggester
            placeholder="model_example"
            [initialValue]="item?.extraInfo?.model"
            [value]="selectedModel"
            [suggestions]="modelSuggestions"
            (inputChange)="getModels($event)"
            (suggestionSelect)="selectBrandOrModel($event, 'model')"
          >
          </tsl-keyword-suggester>
        </div>
      </div>
    </div>
  </div>
  <div
    class="box"
    [ngbPopover]="coachmarkShipping"
    triggers="mouseenter:mouseleave"
    *ngIf="
      categoryId === '-1' ||
      (item && item.itemType === itemTypes.CONSUMER_GOODS)
    "
  >
    <div class="selector-container shipping-options" data-toggle="buttons">
      <h2 i18n>Shipping</h2>
      <p i18n>
        You can send (almost) anything through wallapop. And it's free for you!
      </p>
      <div ngbRadioGroup name="radioBasic" formControlName="delivery_info">
        <label
          ngbButtonLabel
          class="btn selector"
          *ngFor="let delivery of deliveryInfo"
        >
          <input
            ngbButton
            type="radio"
            [value]="delivery.value"
            (click)="onDeliveryChange(delivery.value)"
          />
          <mat-icon
            svgIcon="shipping-{{ delivery.value.max_weight_kg }}"
          ></mat-icon>
          <span
            ><strong>{{ delivery.value.max_weight_kg }}kg max</strong></span
          >
        </label>
      </div>
    </div>
    <ng-template #coachmarkShipping>
      <div i18n>
        Tell us how much your product weighs. Remember that the sum of the
        length, height and width can not exceed 270cm.
      </div>
    </ng-template>
  </div>
  <div
    class="box"
    [ngbPopover]="coachmarkExtras"
    triggers="mouseenter:mouseleave"
  >
    <div
      class="selector-container terms-options"
      formGroupName="sale_conditions"
      data-toggle="buttons"
    >
      <h2 i18n>Further information</h2>
      <label
        class="btn selector"
        [class.active]="uploadForm.value.sale_conditions.fix_price"
      >
        <input type="checkbox" formControlName="fix_price" />
        <mat-icon svgIcon="firm-price"></mat-icon>
        <span i18n>Firm Price</span>
      </label>
      <label
        class="btn selector"
        [class.active]="uploadForm.value.sale_conditions.exchange_allowed"
      >
        <input type="checkbox" formControlName="exchange_allowed" />
        <mat-icon svgIcon="accept-trades"></mat-icon>
        <span i18n>Accept trades</span>
      </label>
    </div>
    <ng-template #coachmarkExtras>
      <div i18n>FAQ</div>
    </ng-template>
  </div>
  <tsl-location-box
    [form]="uploadForm"
    name="location"
    (locationSelected)="emitLocation()"
  ></tsl-location-box>
  <tsl-urgent-checkbox
    [categoryId]="categoryId"
    [urgentPrice]="urgentPrice"
    (urgentSelected)="selectUrgent($event)"
  ></tsl-urgent-checkbox>
  <tsl-button
    [type]="'submit'"
    className="btn-primary btn-big"
    [disabled]="loading"
    [loading]="loading"
  >
    <span *ngIf="!item" i18n>Post Ad</span>
    <span *ngIf="item" i18n>Update</span>
  </tsl-button>
  <button
    type="button"
    (click)="preview()"
    class="btn btn-link"
    [disabled]="!uploadForm.valid"
    tslTrackEvent="UPLOADFORM_PREVIEW"
    i18n
  >
    How does it look?
  </button>
</form>
