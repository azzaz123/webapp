<div class="KYCUploadImages" *ngIf="userDevicePermissions$ | async as userDevicePermissions">
    <div class="row">
        <div class="col">
            <a class="KYCUploadImages__back d-flex pb-4 pb-md-2" (click)="handleBack()">
                <tsl-svg-icon src="/assets/icons/back-arrow.svg" class="align-self-center"></tsl-svg-icon>
                <span i18n="@@web_catalog_pro_pages_checkout_638" class="ml-3">Back</span>
            </a>
        </div>
    </div>
    <div class="row mb-4 mt-2">
        <div class="col col-md-11 offset-md-1">
            <h3 id="KYCUploadImages__title">{{title}}</h3>
            <div *ngIf="isShootImageMethod">
                <span class="d-block">Go somewhere with good lighting and take the photo. Make sure the document you provide is valid for at least 3 months.</span>
                <span class="d-block">All the details on your document must be clear and perfectly legible.</span>
            </div>
        </div>
    </div>
    <div class="row mx-0 mx-md-2 mb-4 justify-content-center" *ngIf="(isShootImageMethod && requestCameraSucceed(userDevicePermissions.video)) || isUploadImageMethod">
        <div class="GenericCard KYCUploadImages__image col-5 p-0" 
            [ngClass]="{'KYCUploadImages__image--enabled': isFrontSideImageDefined || isUploadImageMethod, 'KYCUploadImages__image--active': !isFrontSideImageDefined && isShootImageMethod}">
            <input #frontSideImageUpload id="frontSideImageUpload" type="file" (change)="defineImage($event, KYC_IMAGES.FRONT_SIDE)" class="d-none" [accept]="MIME_TYPES.IMAGE_JPEG">
            <div *ngIf="!isFrontSideImageDefined" id="takeFrontSideImage"
                (click)="checkIfUploadIsAvailable(KYC_IMAGES.FRONT_SIDE)"
                class="w-100 h-100 d-flex flex-column align-items-center justify-content-center text-center p-2">
                <span class="GenericCard__title KYCUploadImages__image__title" i18n="@@kyc_request_front_side_photo">Take a photo of the front side</span>
                <span class="GenericCard__subtitle m-0" i18n="@@kyc_jpeg_png_file">JPEG or PNG files only</span>
            </div>
            <a *ngIf="isFrontSideImageDefined" id="deleteFrontSideImage"
                (click)="removeImage(KYC_IMAGES.FRONT_SIDE)"
                class="position-absolute align-items-center justify-content-center">
                <tsl-svg-icon src="/assets/icons/cross.svg"></tsl-svg-icon>
              </a>
            <canvas #frontSideImage id="frontSideImage" class="KYCUploadImages__takenImage w-100 h-100" [ngClass]="{'d-none': !isFrontSideImageDefined}"></canvas>
        </div>
        <div *ngIf="imagesNeeded === 2" class="GenericCard KYCUploadImages__image col-5 p-0 ml-3"
        [ngClass]="{'KYCUploadImages__image--active': isFrontSideImageDefined && !allImagesAreDefined,
        'KYCUploadImages__image--enabled': isBackSideImageDefined || isUploadImageMethod}">
            <input #backSideImageUpload id="backSideImageUpload" type="file" (change)="defineImage($event, KYC_IMAGES.BACK_SIDE)" class="d-none" [accept]="MIME_TYPES.IMAGE_JPEG">
            <div *ngIf="!isBackSideImageDefined" id="takeBackSideImage"
                (click)="checkIfUploadIsAvailable(KYC_IMAGES.BACK_SIDE)"
                class="w-100 h-100 d-flex flex-column align-items-center justify-content-center text-center p-2">
                <span class="GenericCard__title KYCUploadImages__image__title" i18n="@@kyc_request_back_side_photo">Take a photo of the back side</span>
                <span class="GenericCard__subtitle m-0" i18n="@@kyc_jpeg_png_file">JPEG or PNG files only</span>
            </div>
            <a *ngIf="isBackSideImageDefined" id="deleteBackSideImage"
                (click)="removeImage(KYC_IMAGES.BACK_SIDE)"
                class="position-absolute align-items-center justify-content-center">
                <tsl-svg-icon src="/assets/icons/cross.svg"></tsl-svg-icon>
            </a>
            <canvas #backSideImage id="backSideImage" class="KYCUploadImages__takenImage w-100 h-100" [ngClass]="{'d-none': !isBackSideImageDefined}"></canvas>
        </div>
    </div>
    <div class="row">
        <div class="col">
            <div *ngIf="requestCameraFailed(userDevicePermissions.video) && isShootImageMethod else takingImageSection" class="mx-3">
                <tsl-banner [specifications]="errorBannerSpecifications">
                    <div class="d-flex align-items-center">
                        <tsl-svg-icon src="/assets/icons/wallet/kyc/banner/error.svg"></tsl-svg-icon>{{cameraFailedCopy(userDevicePermissions.video)}}
                    </div>
                </tsl-banner>
            </div>
            <ng-template #takingImageSection>
                <div class="justify-content-center row" [ngClass]="{'d-none': !requestCameraSucceed(userDevicePermissions.video)}">
                    <div class="KYCUploadImages__cameraContainer col-12 col-sm-8 p-0">
                        <video autoplay playsInline muted #userCamera class="h-100 w-100 p-2 p-sm-0"></video>
                        <div class="KYCUploadImages__cameraContainer__overlay position-absolute"></div>
                    </div>
                </div>
                <div class="text-center row mt-3" *ngIf="requestCameraSucceed((userDevicePermissions$ | async).video) || isUploadImageMethod">
                    <tsl-button 
                        *ngIf="!allImagesAreDefined" id="imagesCounterButton"
                        class="col"
                        [disabled]="isUploadImageMethod"
                        (click)="takeImage()">{{actionButtonCopy}} ({{imagesTakenCounter}}/{{imagesNeeded}})</tsl-button>
                    <tsl-button 
                        *ngIf="allImagesAreDefined" id="endVerificationButton"
                        i18n="@@kyc_end_verification"
                        class="col"
                        (click)="endVerification.emit()">End verification</tsl-button>
                </div>
            </ng-template>
        </div>
    </div>
</div>