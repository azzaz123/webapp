<div class="AddNewSubscription__box">
  <div class="AddNewSubscription__box-header">
    <div class="modal-close" (click)="activeModal.dismiss()">
        <mat-icon svgIcon="cross"></mat-icon>
    </div>
    <h4 class="AddNewSubscription__box--title">Add new subscription</h4>
    <p class="AddNewSubscription__box--subtitle">What limit do you want to put on your subscription?</p>
  </div>
  <ngb-carousel interval="0" (slide)="onSlide($event)">
    <ng-template ngbSlide>
      <div class="step step-1">
        <div class="box-content">
          <p class="AddNewSubscription__listing-limit-steps">Paso <span class="bold">1</span> de <span class="bold">2</span></p>
          <div class="AddNewSubscription__listing-limit-title">¿Cuantos productos vas a tener en tu perfil?</div>
          <div class="AddNewSubscription__listing-limit-container">
            <div *ngFor="let tier of subscription.tiers; let i = index" class="AddNewSubscription__listing-limit-box"
            (click)="selectListingLimit(subscription.tiers[i])" [ngClass]="{selected: subscription.selected_tier.limit === subscription.tiers[i].limit}">
            <span *ngIf="subscription.tiers[i].limit >= 0">{{subscription.tiers[i].limit}}</span>
            <span *ngIf="subscription.tiers[i].limit < 0">Unlimited</span>
          </div>
          </div>
          <hr />
          <div class="row AddNewSubscription__listing-limit-payment">
            <div class="col-6 AddNewSubscription__listing-limit-selection AddNewSubscription__listing-limit-selection--left">
                <span>{{subscription.category_name}}</span>
                <br />
                <span *ngIf="subscription.selected_tier">
                  <span *ngIf="subscription.selected_tier.limit < 0">Unlimited products</span>
                  <span *ngIf="subscription.selected_tier.limit >= 0">{{subscription.selected_tier.limit}} products</span>
                </span>
                <span *ngIf="!subscription.selected_tier">0 productos</span>
            </div>
            <div class="col-6 AddNewSubscription__listing-limit-selection AddNewSubscription__listing-limit-selection--right">
                <span class="AddNewSubscription__listing-limit-price" *ngIf="subscription.selected_tier">{{subscription.selected_tier.price}}{{subscription.selected_tier.currency}}/mes</span>
                <span class="AddNewSubscription__listing-limit-price" *ngIf="!subscription.selected_tier">- /mes</span>
            </div>
          </div>
        </div>
        <tsl-button *ngIf="currentSlide === 'ngb-slide-0'" [disabled]="!subscription.selected_tier" (click)="carousel.next()" i18n>Continue to payment</tsl-button>
      </div>
    </ng-template>
    <ng-template ngbSlide>
      <div class="step step-2">
        <div class="box-content">
          <p class="AddNewSubscription__listing-limit-steps">Paso <span class="bold">2</span> de <span class="bold">2</span></p>
          <div class="AddNewSubscription__listing-limit-title">Define la forma de pago</div>
          <div class="row AddNewSubscription__listing-limit-payment">
            <div class="col-6 AddNewSubscription__listing-limit-selection AddNewSubscription__listing-limit-selection--left">
                <span>{{subscription.category_name}}</span>
                <br />
                <span *ngIf="subscription.selected_tier">
                  <span *ngIf="subscription.selected_tier.limit < 0">Unlimited products</span>
                  <span *ngIf="subscription.selected_tier.limit >= 0">{{subscription.selected_tier.limit}} products</span>
                </span>
                <span *ngIf="!subscription.selected_tier">0 productos</span>
            </div>
            <div class="col-6 AddNewSubscription__listing-limit-selection AddNewSubscription__listing-limit-selection--right">
              <span class="AddNewSubscription__listing-limit-price" *ngIf="subscription.selected_tier">{{subscription.selected_tier.price}}{{subscription.selected_tier.currency}}/mes</span>
              <span class="AddNewSubscription__listing-limit-price" *ngIf="!subscription.selected_tier">- /mes</span>
                <br />
                <span class="AddNewSubscription__listing-limit-payment-edit" (click)="carousel.prev()">Change</span>
            </div>
          </div>
          <div class="row AddNewSubscription__payment">
              <div class="AddNewSubscription__group form-group align-items-center">
                <div class="AddNewSubscription__selection">
                  <tsl-stripe-card-selection *ngIf="savedCard" (onSelectExistingCard)="setSavedCard($event)"
                  (hasStripeCard)="hasStripeCard($event)"></tsl-stripe-card-selection>
                </div>
                <div class="AddNewSubscription__payment-add-card" (click)="addNewCard()" *ngIf="savedCard" i18n>+ Add another credit card</div>
                <div class="AddNewSubscription__payment-response-message" *ngIf="isPaymentError">
                  <p>The payment failed. Please enter another credit card.</p>
                </div>
                <div class="AddNewSubscription__payment-add-card" (click)="removeNewCard()" *ngIf="showCard" i18n>Use saved card</div>
                <tsl-stripe-card-element *ngIf="showCard" [newLoading]="loading" [disabled]="isPaymentError" [type]="'subscription'" [listingLimit]="subscription.selected_tier" [action]="action" (onStripeCardCreate)="addSubscription($event)"
                (stripeCard)="setCardInfo($event)"></tsl-stripe-card-element>
              </div>
              <tsl-button [hidden]="!savedCard"
              [disabled]="!selectedCard || !subscription.selected_tier || loading"
              [loading]="loading"
              (click)="addSubscriptionFromSavedCard()"
              id="qa-checkout-subscription"
              className="btn-primary btn-medium stripe"
              llàstmi18n>Add Subscription</tsl-button>
            </div>
        </div>
      </div>
    </ng-template>
  </ngb-carousel>
</div>