<h1 i18n>My features</h1>
<div class="clean-cart" [hidden]="!cart?.total">
  <a (click)="clean()">
    <span i18n>Delete list</span>
  </a>
</div>
<div [class.with-credits]="creditInfo?.currencyName === 'wallacredits'">
  <div class="cart-wrapper" [class.has-financial-card]="hasFinancialCard"
       [class.no-credit]="!creditInfo?.credit"
       [class.no-discount]="!cart?.discountedTotal && !creditInfo?.credit">
    <div class="scroll-panel">
      <ul *ngIf="cart" class="items-list">
        <li *ngFor="let type of types" [hidden]="!cart[type].cartItems.length" [ngClass]="type">
          <div class="type-total cart-box" [ngClass]="{collapsed: cart[type].collapsed}"
               (click)="cart[type].collapsed = !cart[type].collapsed">
            <mat-icon class="wing-icon" svgIcon="wing-{{type}}"></mat-icon>
            <div class="type">
              <span [ngSwitch]="type">
                <ng-container *ngSwitchCase="'zonebump'">
                  <ng-container *ngIf="!provincialBump" i18n>Local bump</ng-container>
                  <ng-container *ngIf="provincialBump" i18n>Provincial bump</ng-container>
                </ng-container>
                <ng-container *ngSwitchCase="'citybump'" i18n>City bump</ng-container>
                <ng-container *ngSwitchCase="'countrybump'" i18n>Country bump</ng-container>
              </span>
              <strong>x {{cart[type].cartItems.length}}</strong><br />
              <span class="price">
                {{cart[type].total * creditInfo?.factor | customCurrency:creditInfo?.currencyName}}
                <tsl-wallacoin [currency]="creditInfo?.currencyName" color="grey"></tsl-wallacoin>
              </span>
            </div>
            <mat-icon class="arrow-icon" svgIcon="arrow-right"></mat-icon>
          </div>
          <ul [hidden]="cart[type].collapsed">
            <li *ngFor="let cartItem of cart[type].cartItems" class="cart-item">
              <mat-icon svgIcon="remove" class="close-icon" (click)="remove(cartItem, type)"></mat-icon>
              <div class="cart-box">
                <tsl-item-avatar [item]="cartItem.item" size="small" fallbackLight="true"></tsl-item-avatar>
                <div class="type">
                  <span [ngSwitch]="type">
                    <ng-container *ngSwitchCase="'zonebump'">
                      <ng-container *ngIf="!provincialBump" i18n>Local</ng-container>
                      <ng-container *ngIf="provincialBump" i18n>Provincial</ng-container>
                    </ng-container>
                    <ng-container *ngSwitchCase="'citybump'" i18n>City</ng-container>
                    <ng-container *ngSwitchCase="'countrybump'" i18n>Country</ng-container>
                  </span>
                  x {{cartItem.duration.duration / 24}}<span i18n>days</span>
                </div>
                <div class="price">
                  {{cartItem.duration.market_code * creditInfo?.factor | customCurrency:creditInfo?.currencyName}}
                  <tsl-wallacoin [currency]="creditInfo?.currencyName" color="grey"></tsl-wallacoin>
                </div>
              </div>
            </li>
          </ul>
        </li>
      </ul>
    </div>
  </div>
  <div class="walla-total" [hidden]="!creditInfo?.credit">
    <span class="label" i18n>Total</span>
    <span class="price">
      {{cart?.total * creditInfo?.factor | customCurrency:creditInfo?.currencyName}}
      <tsl-wallacoin [currency]="creditInfo?.currencyName" size="medium" color="grey"></tsl-wallacoin>
    </span>
  </div>
  <div class="credit" [hidden]="!creditInfo?.credit && !usedCredits">
    <span class="label" [hidden]="!creditInfo?.credit">
      <span [hidden]="creditInfo?.currencyName !== 'wallacredits'">
        {{creditInfo?.credit | customCurrency:creditInfo?.currencyName}} <span i18n>credit</span>
      </span>
      <span [hidden]="creditInfo?.currencyName === 'wallacredits'">
        <tsl-wallacoin [currency]="creditInfo?.currencyName" size="medium" color="corporate"></tsl-wallacoin>
        <span i18n>spending</span>
      </span>
    </span>
    <span class="price" [hidden]="!usedCredits">
      {{usedCredits | customCurrency:creditInfo?.currencyName}}
      <tsl-wallacoin [currency]="creditInfo?.currencyName" size="medium" color="corporate"></tsl-wallacoin>
    </span>
  </div>
  <div class="missing" [hidden]="creditInfo?.currencyName === 'wallacredits' || !creditInfo?.credit">
    <div class="label">
      <tsl-wallacoin [currency]="creditInfo?.currencyName" size="medium" color="strike"></tsl-wallacoin>
      <span i18n>missing</span>
    </div>
    <div class="price">
      {{totalToPay * creditInfo?.factor | number}}
      <tsl-wallacoin [currency]="creditInfo?.currencyName" size="medium" color="grey"></tsl-wallacoin>
    </div>
  </div>
  <div class="discounted-total" *ngIf="!creditInfo?.credit && cart?.discountedTotal">
    <s>{{cart?.discountedTotal | customCurrency:creditInfo?.currencyName}}</s>
  </div>
  <div class="total">
    <span class="label" i18n>Total to pay</span>
    <span class="price">{{totalToPay | customCurrency}}</span>
  </div>
  <tsl-card-selection [hidden]="isStripe" [(ngModel)]="cardType" name="card-type" (hasCard)="hasCard($event)"
  ></tsl-card-selection>
  <tsl-stripe-card-selection *ngIf="isStripe && isStripeCard && savedCard" (onSelectExistingCard)="setSavedCard($event)"
                             (hasStripeCard)="hasStripeCard($event)"
  ></tsl-stripe-card-selection>
  <div class="Cart__NewCard--add" (click)="addNewCard()" *ngIf="isStripe && savedCard" i18n>+ Add another credit card</div>
  <div class="Cart__NewCard--used" (click)="removeNewCard()" *ngIf="isStripe && showCard && isStripeCard" i18n>Use saved card</div>
  <tsl-stripe-card-element *ngIf="isStripe && showCard" [type]="'cart'" [cart]="cart" (stripeCardToken)="checkout($event)"
                           (stripeCard)="setCardInfo($event)" [loading]="loading"
  ></tsl-stripe-card-element>
  <tsl-button [hidden]="isStripe && !savedCard"
              [disabled]="(!cart?.total || loading) || (isStripe && !selectedCard)"
              [loading]="loading"
              (click)="checkout()"
              id="qa-checkout-buy"
              className="btn-primary btn-medium stripe"
              i18n>Continue to Checkout</tsl-button>
  <div class="secure-payment" [hidden]="isStripe">
    <mat-icon svgIcon="secure-card"></mat-icon>
    <span i18n>Secure payment through Sabadell</span>
  </div>
</div>
<tsl-sabadell [hidden]="isStripe" [submit]="sabadellSubmit"></tsl-sabadell>

